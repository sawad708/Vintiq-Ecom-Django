{% extends 'layouts/main.html' %}

{% load static %}

{% block body %}
    <!-- Breadcrumb Area Start Here -->
    <div class="breadcrumbs-area position-relative">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <div class="breadcrumb-content position-relative section-content">
                        <h3 class="title-3">Shopping Cart</h3>
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li>Shopping Cart</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb Area End Here -->
    <!-- cart main wrapper start -->
    <div class="cart-main-wrapper mt-no-text">
        <div class="container custom-area">
            <div class="row">
                <div class="col-lg-12 col-custom">
                    <!-- Cart Table Area -->
                    <div class="cart-table table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th class="pro-thumbnail">Image</th>
                                    <th class="pro-title">Product</th>
                                    <th class="pro-price">Price</th>
                                    <th class="pro-quantity">Quantity</th>
                                    <th class="pro-subtotal">Total</th>
                                    <th class="pro-remove">Remove</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for cart_item in cart_items %}
                                <tr>
                                    <td class="pro-thumbnail">
                                        {% for img in cart_item.variant.variant_image.all %}
                                        {% if forloop.counter == 1 %}
                                        <a href="#"><img class="img-fluid" src="{{img.pr_images.url}}" alt="Product" /></a>
                                        {% endif %}
                                        {% endfor %}
                                    </td>
                                    <td class="pro-title"><a href="#">{{cart_item.variant.product.product_name}}-{{cart_item.variant.color}} </a></td>
                                    <td class="pro-price"><span>"{{cart_item.variant.price}}"</span></td>
                                    <td class="pro-quantity">
                                        {% comment %} <div class="quantity">
                                            <div class="cart-plus-minus"> 
                                             <input class="cart-plus-minus-box" value="{{cart_item.quantity}}" name="quantity" type="number">
                                                <div class="dec qtybutton"><a href="{% url "decrement_cart_item" cart_item.id %}">-</a></div>
                                                <div class="inc qtybutton"><a href="{% url "increment_cart_item" cart_item.id %}">+</a></div> 
                                               <div class="dec qtybutton"><i class="fa fa-minus"></i></div>
                                                <div class="inc qtybutton"><i class="fa fa-plus"></i></div> 
                                             </div> {% endcomment %}

                                             <div style="width: 5px;">
                                                <button type="button" class="dec qtybutton" style="background-color: #E72463; color: #ffffff; border: none; padding: 5px;">
                                                    <a href="{% url 'decrement_cart_item' cart_item.id %}" style="text-decoration: none; color: inherit;"><strong>-</strong></a>
                                                </button>
                                                <input type="number" style="width: 30px; text-align: center;" class="cart-plus-minus-box" step="1" min="0" max="" name="quantity" value="{{ cart_item.quantity }}" title="Qty" size="4" width="4px" placeholder="" inputmode="numeric" autocomplete="off">
                                                <button type="button" class="inc qtybutton" style="background-color: #E72463; color: #ffffff; border: none; padding: 5px;">
                                                    <a href="{% url 'increment_cart_item' cart_item.id %}" style="text-decoration: none; color: inherit;"><strong>+</strong></a>
                                                </button>
                                            </div> 
                                            
                                            
                                    </td>

                                    <td class="pro-subtotal"><span>{{cart_item.get_total_price}}</span></td>
                                    <td class="pro-remove"><a href="{% url "delete_cart_item" cart_item.id %}"><i class="lnr lnr-trash"></i></a></td>
                                </tr>
                                {% endfor %}
                                {% comment %} <tr>
                                    <td class="pro-thumbnail"><a href="#"><img class="img-fluid" src="assets/images/product/small-size/2.jpg" alt="Product" /></a></td>
                                    <td class="pro-title"><a href="#">Jack in the Pulpit <br> red</a></td>
                                    <td class="pro-price"><span>$275.00</span></td>
                                    <td class="pro-quantity">
                                        <div class="quantity">
                                            <div class="cart-plus-minus">
                                                <input class="cart-plus-minus-box" value="0" type="text">
                                                <div class="dec qtybutton">-</div>
                                                <div class="inc qtybutton">+</div>
                                                <div class="dec qtybutton"><i class="fa fa-minus"></i></div>
                                                <div class="inc qtybutton"><i class="fa fa-plus"></i></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="pro-subtotal"><span>$550.00</span></td>
                                    <td class="pro-remove"><a href="#"><i class="lnr lnr-trash"></i></a></td>
                                </tr>
                                <tr>
                                    <td class="pro-thumbnail"><a href="#"><img class="img-fluid" src="assets/images/product/small-size/3.jpg" alt="Product" /></a></td>
                                    <td class="pro-title"><a href="#">Glory of the Snow <br> s</a></td>
                                    <td class="pro-price"><span>$295.00</span></td>
                                    <td class="pro-quantity">
                                        <div class="quantity">
                                            <div class="cart-plus-minus">
                                                <input class="cart-plus-minus-box" value="0" type="text">
                                                <div class="dec qtybutton">-</div>
                                                <div class="inc qtybutton">+</div>
                                                <div class="dec qtybutton"><i class="fa fa-minus"></i></div>
                                                <div class="inc qtybutton"><i class="fa fa-plus"></i></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="pro-subtotal"><span>$295.00</span></td>
                                    <td class="pro-remove"><a href="#"><i class="lnr lnr-trash"></i></a></td>
                                </tr>
                                <tr>
                                    <td class="pro-thumbnail"><a href="#"><img class="img-fluid" src="assets/images/product/small-size/4.jpg" alt="Product" /></a></td>
                                    <td class="pro-title"><a href="#">Rose bouquet white</a></td>
                                    <td class="pro-price"><span>$110.00</span></td>
                                    <td class="pro-quantity">
                                        <div class="quantity">
                                            <div class="cart-plus-minus">
                                                <input class="cart-plus-minus-box" value="2" type="text">
                                                <div class="dec qtybutton">-</div>
                                                <div class="inc qtybutton">+</div>
                                                <div class="dec qtybutton"><i class="fa fa-minus"></i></div>
                                                <div class="inc qtybutton"><i class="fa fa-plus"></i></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="pro-subtotal"><span>$110.00</span></td>
                                    <td class="pro-remove"><a href="#"><i class="lnr lnr-trash"></i></a></td>
                                </tr> {% endcomment %}
                            </tbody>
                        </table>
                    </div>
                    <!-- Cart Update Option -->
                    <div class="cart-update-option d-block d-md-flex justify-content-between">
                        <div class="apply-coupon-wrapper">
                            <form action="#" method="post" class=" d-block d-md-flex">
                                 {% csrf_token %}
                                {% if cart.coupon %}
                                <input type="hidden" name="cancel_coupon">
                                <button class="btn flosun-button primary-btn rounded-0 black-btn">Remove Coupon</button>
                                {% else %}
                                <input type="text" name="coupon" placeholder="Enter Your Coupon Code" required />
                                <button class="btn flosun-button primary-btn rounded-0 black-btn">Apply Coupon</button>
                                {% endif %}
                            </form>
                        </div>
                        <div class="cart-update mt-sm-16">
                            <a href="{% url "shop" %}" class="btn flosun-button primary-btn rounded-0 black-btn">Update Cart</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-5 ml-auto col-custom">
                    <!-- Cart Calculation Area -->
                    <div class="cart-calculator-wrapper">
                        <div class="cart-calculate-items">
                            <h3>Cart Totals</h3>
                            <div class="table-responsive">
                                <table class="table">
                                    <tr>
                                        <td>Sub Total</td>
                                        <td>{{cart.get_total_price}}</td>
                                    </tr>
                                    <tr>
                                        {% if cart.coupon %}
                                        <td>Coupen Applied </td>
                                        {% endif %}
                                    </tr>
                                    <tr>
                                        {% if cart.coupon %}
                                        <td>Coupen Savings</td>
                                        <td>{{ cart.coupon.discount_price }}</td>
                                        {% endif %}
                                    </tr>
                                    <tr>
                                        <td>Shipping</td>
                                        <td>0</td>
                                    </tr>
                                    <tr class="total">
                                        <td>Total</td>
                                        <td class="total-amount">{{total}}</td>
                                    </tr>
                                    
                                </table>
                            </div>
                        </div>
                        <a href="{% url "checkout" %}" class="btn flosun-button primary-btn rounded-0 black-btn w-100">Proceed To Checkout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- cart main wrapper end -->

    <script>
        $(document).ready(function() {
            $(".qtybutton.dec").click(function(event) {
                event.preventDefault(); // Prevent the default link behavior
                var input = $(this).closest(".cart-plus-minus").find("input");
                var newValue = parseInt(input.val()) - 1;
                if (newValue >= 0) {
                    input.val(newValue);
                    var itemId = {{ cart_item.id }}; // Use cart_item.id directly
                    var decrementUrl = "{% url 'decrement_cart_item' 0 %}".replace('0', itemId); // Construct the decrement URL
                    // Send an AJAX request to decrement the quantity
                    $.ajax({
                        url: decrementUrl,
                        method: "GET", // You can adjust the HTTP method as needed
                        success: function(response) {
                            // Handle the response if needed (e.g., update the cart total)
                        },
                        error: function() {
                            // Handle errors if necessary
                        }
                    });
                }
            });
    
            $(".qtybutton.inc").click(function(event) {
                event.preventDefault(); // Prevent the default link behavior
                var input = $(this).closest(".cart-plus-minus").find("input");
                var newValue = parseInt(input.val()) + 1;
                input.val(newValue);
                var itemId = {{ cart_item.id }}; // Use cart_item.id directly
                var incrementUrl = "{% url 'increment_cart_item' 0 %}".replace('0', itemId); // Construct the increment URL
                // Send an AJAX request to increment the quantity
                $.ajax({
                    url: incrementUrl,
                    method: "GET", // You can adjust the HTTP method as needed
                    success: function(response) {
                        // Handle the response if needed (e.g., update the cart total)
                    },
                    error: function() {
                        // Handle errors if necessary
                    }
                });
            });
        });
    </script>
    
        
    {% endblock body %}